echo "starting test_agent_name"

def agent_name = ""

node('worker') {
  
  stage ("Build") {
    agent_name = env.NODE_NAME
    sh "echo 'we are just running something on this worker, so we can test grabbing its NODE_NAME, which is synonymous with agent_name'"
  }
  
}
echo "agent_name: ${agent_name}"
agent_instance_id = agent_name.find(/i\-[a-z\d]+/)

stage("Save") {

  node('master') {
    echo "starting save"
    env.agent_instance_id = agent_instance_id
    sh 'wget https://raw.githubusercontent.com/FirstDraftGIS/firstdraft/master/bash_scripts/save.sh -O /tmp/save.sh'
    sh "sudo -n bash /tmp/save.sh"
    echo "ending save"
  }

}

echo "finishing test_agent_name"
